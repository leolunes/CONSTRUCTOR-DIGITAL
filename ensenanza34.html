<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Auditoría del Hogar — Sistema Estructural</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <!-- Estilos -->
  <link rel="stylesheet" href="estilo.css">

  <style>
    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
      background: #0f172a;
      color: #e5e7eb;
      margin: 0;
      padding: 20px;
    }

    .container {
      max-width: 900px;
      margin: auto;
      background: #020617;
      border-radius: 12px;
      padding: 24px;
      box-shadow: 0 0 30px rgba(0,0,0,.4);
    }

    h1 {
      margin-top: 0;
      text-align: center;
    }

    .meta {
      display: grid;
      gap: 12px;
      margin-bottom: 24px;
    }

    .meta input, .meta textarea {
      width: 100%;
      padding: 10px;
      border-radius: 6px;
      border: none;
      background: #020617;
      color: #e5e7eb;
      border: 1px solid #334155;
    }

    .section {
      margin-bottom: 28px;
      padding-bottom: 20px;
      border-bottom: 1px solid #334155;
    }

    .question {
      margin: 12px 0;
    }

    .question label {
      display: block;
      margin-bottom: 6px;
    }

    .question input {
      width: 80px;
    }

    .buttons {
      display: flex;
      flex-wrap: wrap;
      gap: 12px;
      margin-top: 20px;
    }

    button {
      padding: 10px 16px;
      border-radius: 8px;
      border: none;
      cursor: pointer;
      font-weight: bold;
    }

    .primary { background: #22c55e; color: #020617; }
    .secondary { background: #38bdf8; color: #020617; }
    .danger { background: #ef4444; color: white; }

    .result {
      margin-top: 24px;
      padding: 16px;
      border-radius: 10px;
      background: #020617;
      border: 1px solid #334155;
      display: none;
    }

    .error {
      background: #7f1d1d;
      padding: 10px;
      border-radius: 8px;
      margin-bottom: 20px;
    }
  </style>
</head>

<body>
<div class="container">

  <h1>Auditoría del Hogar — Sistema Estructural</h1>

  <div class="meta">
    <input id="paciente" placeholder="Nombre del hogar / paciente">
    <input id="auditor" placeholder="Nombre del auditor">
    <input id="fecha" type="date">
    <textarea id="observaciones" rows="3" placeholder="Observaciones generales"></textarea>
  </div>

  <div id="error" class="error" style="display:none"></div>

  <div id="form"></div>

  <div class="buttons">
    <button class="primary" onclick="verResultado()">Ver resultado</button>
    <button class="secondary" onclick="descargarEvaluacion()">Descargar evaluación</button>
    <button class="danger" onclick="reiniciar()">Reiniciar</button>
    <strong>Puntaje actual: <span id="score">0</span></strong>
  </div>

  <div id="resultado" class="result"></div>

  <p style="margin-top:16px; font-size:0.9em; opacity:.8">
    Recomendación pastoral: interprete el resultado acompañado.  
    No entregue el número como sentencia; tradúzcalo a lenguaje de diseño.
  </p>

</div>

<script>
/* =========================================================
   CONFIGURACIÓN CLAVE — OPCIÓN A
   ========================================================= */
const JSON_PATH = "ensenanza34.json";

/* ========================================================= */

let DATA = null;
let lastReportText = "";

async function init(){
  try{
    const res = await fetch(JSON_PATH);
    if(!res.ok) throw new Error("No se pudo cargar el JSON: " + res.status);
    DATA = await res.json();
    renderForm();
    setDefaultDate();
  }catch(e){
    showError(e.message);
  }
}

function showError(msg){
  const el = document.getElementById("error");
  el.style.display = "block";
  el.textContent = "Error: " + msg;
}

function setDefaultDate(){
  document.getElementById("fecha").valueAsDate = new Date();
}

function renderForm(){
  const form = document.getElementById("form");
  form.innerHTML = "";

  DATA.sections.forEach((sec, si)=>{
    const div = document.createElement("div");
    div.className = "section";
    div.innerHTML = `<h3>${sec.title}</h3><p>${sec.description}</p>`;

    sec.questions.forEach((q, qi)=>{
      const qDiv = document.createElement("div");
      qDiv.className = "question";
      qDiv.innerHTML = `
        <label>${q.text}</label>
        <input type="number" min="0" max="${q.max}" value="0"
          onchange="updateScore()" 
          data-section="${si}" 
          data-question="${qi}">
      `;
      div.appendChild(qDiv);
    });

    form.appendChild(div);
  });
}

function updateScore(){
  let total = 0;
  document.querySelectorAll("input[type=number]").forEach(i=>{
    total += Number(i.value || 0);
  });
  document.getElementById("score").textContent = total;
}

function verResultado(){
  const total = Number(document.getElementById("score").textContent);
  let nivel = "";
  let mensaje = "";

  if(total <= 30){
    nivel = "Hogar alineado";
    mensaje = "La estructura está funcionando conforme al diseño.";
  } else if(total <= 60){
    nivel = "Hogar en ajuste";
    mensaje = "Existen desalineaciones corregibles con acompañamiento.";
  } else if(total <= 95){
    nivel = "Hogar en riesgo";
    mensaje = "El sistema presenta fallas estructurales visibles.";
  } else {
    nivel = "Hogar crítico";
    mensaje = "Requiere proceso pastoral, no corrección inmediata.";
  }

  lastReportText = `
HOGAR: ${paciente.value}
AUDITOR: ${auditor.value}
FECHA: ${fecha.value}

PUNTAJE TOTAL: ${total}
DIAGNÓSTICO: ${nivel}

${mensaje}

OBSERVACIONES:
${observaciones.value}
  `;

  const res = document.getElementById("resultado");
  res.style.display = "block";
  res.innerHTML = `<h3>${nivel}</h3><p>${mensaje}</p>`;
}

function descargarEvaluacion(){
  if(!lastReportText){
    alert("Primero genere el resultado.");
    return;
  }
  const blob = new Blob([lastReportText], {type:"text/plain"});
  const a = document.createElement("a");
  a.href = URL.createObjectURL(blob);
  a.download = "evaluacion-hogar.txt";
  a.click();
}

function reiniciar(){
  location.reload();
}

init();
</script>

</body>
</html>